<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009"
		 xmlns:s="library://ns.adobe.com/flex/spark"
		 xmlns:mx="library://ns.adobe.com/flex/mx"
		 xmlns:components="com.biiway.stockassistant.components.*"
		 initialize="initializeHandler(event)"
		 height="67"
		 width="100%">
	
	<fx:Script>
		<![CDATA[
			import com.biiway.stockassistant.components.TooTip;
			import com.biiway.stockassistant.components.datagrid.CellEvent;
			import com.biiway.stockassistant.util.UIUtil;
			
			import mx.core.IFlexDisplayObject;
			import mx.core.IVisualElement;
			import mx.events.DynamicEvent;
			import mx.events.FlexEvent;
			import mx.events.FlexMouseEvent;
			import mx.managers.PopUpManager;
			
			private var tootip:TooTip;
			
			protected function initializeHandler(event:FlexEvent):void
			{
				initEvent();
			}
			
			private function initEvent():void
			{
				searchinput.addEventListener(FocusEvent.FOCUS_IN,searchinputHandler,false,0,true);
				searchinput.addEventListener(FocusEvent.FOCUS_OUT,searchinputHandler,false,0,true);
				
				detailedWindowImg.addEventListener(MouseEvent.MOUSE_OUT,detailedWindowImgMouseHandler,false,0,true);
				detailedWindowImg.addEventListener(MouseEvent.MOUSE_OVER,detailedWindowImgMouseHandler,false,0,true);
				detailedWindowImg.addEventListener(MouseEvent.CLICK,detailedWindowImgMouseHandler,false,0,true);
			}
			
			protected function cellHandler(event:CellEvent):void
			{
				searchinput.text = event.selected ? event.data["names"] : null; 
			}
			
			///////////////////////////////////////////////////////////////////////////////////////////
			//++以下代码开发者不需要关心++//
			///////////////////////////////////////////////////////////////////////////////////////////
			
			protected function searchinputHandler(event:FocusEvent):void
			{
				switch(event.type)
				{
					case FocusEvent.FOCUS_IN:
						selectedSearchContainer(true);
						break;
					
					case FocusEvent.FOCUS_OUT :
						selectedSearchContainer(false);
						break;
					
					default:
						break;
				}		
			}
			
			private function selectedSearchContainer(value:Boolean):void
			{
				value ? searchTextBC.setStyle("borderColor",0x4D90FE) : searchTextBC.setStyle("borderColor",0xD9D9D9);
			}
			
			protected function detailedWindowImgMouseHandler(event:MouseEvent):void
			{
				var img:Image = event.currentTarget as Image;
				
				switch(event.type)
				{
					case MouseEvent.CLICK :
						var searchWindow:SearchWindow = new SearchWindow();	
						searchWindow.width = searchTextBC.width;
						searchWindow.height = 315;
						searchWindow.addEventListener(FlexMouseEvent.MOUSE_DOWN_OUTSIDE,mouseDownOutsideHandler,false,0,true);
						searchWindow.addEventListener(CellEvent.CELL_VALUE_COMMIT,cellHandler,false,0,true);
						searchWindow.addEventListener(SearchWindow.SUCCESSEVENT,closeSearchWindowHandler,false,0,true);

						var point:Point = UIUtil.getUiAbsolutePosition(searchTextBC);
						point.y += searchTextBC.height;
						searchWindow.x = point.x;
						searchWindow.y = point.y+1;
						searchWindow.parentPoint = point;
						
						setDetailedWindowImgVisible(false);
						
						searchTextBC.setStyle("borderColor",0x4D90FE);
						
						PopUpManager.addPopUp(searchWindow, UIUtil.getApplication(this), false);				
						break;
					
					case MouseEvent.MOUSE_OVER:
						if(img.name == "drop-down")
						{
							img.name = "drop-down-over";
							img.source = null;
							img.source = "assets/image/drop-down-over.png";
							
							this.showTootip(true,img);
						}
						break;
					
					case MouseEvent.MOUSE_OUT :
						if(img.name == "drop-down-over")
						{
							img.name = "drop-down";
							img.source = null;
							img.source = "assets/image/drop-down.png";
							
							this.showTootip(false,img);
						}
						break;
					
					default:
						break;
				}
			}
			
			/**
			 * 关闭查询弹出框，调用
			 */
			protected function closeSearchWindowHandler(event:DynamicEvent):void
			{
				removeWindown(event.currentTarget as IFlexDisplayObject);
			}
			
			private function removeWindown(displayObject:IFlexDisplayObject):void
			{
				selectedSearchContainer(false);
				setDetailedWindowImgVisible(true);
				
				PopUpManager.removePopUp(displayObject);
			}
			
			protected function mouseDownOutsideHandler(event:FlexMouseEvent):void
			{
				removeWindown(event.currentTarget as IFlexDisplayObject);
			}
			
			private function setDetailedWindowImgVisible(value:Boolean):void
			{
				if(detailedWindowImg.visible != value)
				{
					detailedWindowImg.visible = value;
					sLine.visible = value;
				}
			}
			
			private function showTootip(value:Boolean,img:Image):void
			{
				if (value)
				{
					tootip ? null : tootip=new TooTip("显示搜索选项");

					var point:Point = UIUtil.getUiAbsolutePosition(img);
					tootip.x = point.x -30;
					tootip.y = point.y+30;

					PopUpManager.addPopUp(tootip, UIUtil.getApplication(this), false);
				}
				else
				{
					tootip ? PopUpManager.removePopUp(tootip) : null;
				}
			}
			
		]]>
	</fx:Script>
	
	<s:Rect left="0.5" right="0.5" top="0" height="63">
		<s:fill>
			<s:LinearGradient rotation="90">
				<s:GradientEntry color="0xFFFFFF" />
				<s:GradientEntry color="0xE5E9EE" />
			</s:LinearGradient>
		</s:fill>
	</s:Rect>
	
	<s:BitmapImage left="0.5" right="1" top="63" height="5"  source="@Embed('assets/image/DropShadowFilter.png')"/>
	
	<s:BorderContainer id="searchTextBC" top="18" width="338" height="29" backgroundColor="#FFFFFF" borderColor="#D9D9D9" horizontalCenter="-30">
		<components:DefaultInput emptyText="快速查询" id="searchinput" imeMode="CHINESE" height="100%"  borderVisible="false" left="0" right="24" focusAlpha="0" contentBackgroundAlpha="0"/>
		<mx:Image id="detailedWindowImg" name="drop-down" source="assets/image/drop-down.png"  width="21" height="27" right="0" top="0" useHandCursor="true" buttonMode="true"/>
		<s:Line id="sLine" right="21" top="0" width="0" height="26" xFrom="0" xTo="0" yFrom="0" yTo="0">
			<s:stroke>
				<s:SolidColorStroke color="0xD9D9D9" weight="1" caps="square"/>
			</s:stroke>
		</s:Line>
	</s:BorderContainer> 
	<s:Button label="选股" top="18" width="72" height="29" horizontalCenter="190" skinClass="assets.skin.SearchBtnSkin"/>
	
</s:Group>
